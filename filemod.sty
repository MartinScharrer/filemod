
%%%% BASIC PARSER
\def\filemodparse#1#2{%
    \expandafter\filemod@parse\pdffilemoddate{#2}\relax{#1}%
}
\def\filemod@parse#1\relax#2{%
    \ifx\relax#1\relax
        \expandafter\@firstoftwo
    \else
        \expandafter\@secondoftwo
    \fi
    {\filemodnotexists{#2}}%
    {\filemod@parse@#1\empty{#2}\relax}%
}

\def\filemodnotexists#1{%
    #1{0000}{00}{00}{00}{00}{00}{Z}%
}
\begingroup
\@makeother\D
\@makeother:
\gdef\filemod@parse@D:#1#2#3#4#5#6#7#8#9\relax{%
    \filemod@parse@@{{#1#2#3#4}{#5#6}{#7#8}}#9\relax
}
\endgroup
\def\filemod@parse@@#1#2#3#4#5#6#7#8\empty#9\relax{%
    #9#1{#2#3}{#4#5}{#6#7}{#8}%
}
%%%%%

%%%% PRINT MACROS
\def\filemodprint{\filemodparse\thefilemod}
\def\filemodprintdate{\filemodparse\the@filemoddate}
\def\filemodprinttime{\filemodpares\the@filemodtime}

\def\thefilemod#1#2#3#4#5#6#7{%
    \thefilemoddate{#1}{#2}{#3}%
    \filemodsep
    \thefilemodtime{#4}{#5}{#6}{#7}%
}
\let\filemodsep\space
\def\thefilemoddate#1#2#3{%
    #1/#2/#3%
}
\def\thefilemodtime#1#2#3#4{%
    #1:#2:#3~#4%
}
\def\the@filemoddate#1#2#3#4#5#6#7{%
    \thefilemoddate{#1}{#2}{#3}%
}
\def\the@filemodtime#1#2#3{%
    \thefilemodtime
}
%%%%%%%


%%%% NUMERIC RESULTS
\def\filemodnumdate{\filemodparse\filemod@numdate}
\def\filemod@numdate#1#2#3#4#5#6#7{#1#2#3}

\def\filemodnumtime{\filemodparse\filemod@numtime}
\def\filemod@numtime#1#2#3#4#5#6#7{#4#5#6}

\def\filemodgetnum{\filemodparse\filemod@getnum}
\def\filemod@getnum#1#2#3#4#5#6#7{%
    \def\filemoddate{#1#2#3}%
    \def\filemodtime{#4#5#6}%
    \def\filemodtz{#7}%
}
%%%%%%%


%%%%% ADVANCED FILE DATA COMPARISON

\def\filemodNewest#1{%
  \filemod@newest#1\filemod@end
}
\def\filemodOldest#1{%
  \filemod@oldest#1\filemod@end
}
\def\filemodnewest#1#2{\filemodcmp{#1}{#2}{#1}{#2}}
\def\filemodoldest#1#2{\filemodcmp{#1}{#2}{#2}{#1}}

\def\filemod@newest#1#2{%
  \iffilemod@end{#2}%
    {#1}%
    {%
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter\filemod@newest
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter{%
    \expandafter\expandafter
    \expandafter\@gobble
    \expandafter\string\csname\filemodnewest{#1}{#2}\endcsname}}%
}
\def\filemod@oldest#1#2{%
  \iffilemod@end{#2}%
    {#1}%
    {%
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter\filemod@oldest
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter\expandafter
    \expandafter{%
    \expandafter\expandafter
    \expandafter\@gobble
    \expandafter\string\csname\filemodoldest{#1}{#2}\endcsname}}%
}

\def\iffilemod@end#1{%
  \ifx\filemod@end#1%
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi
}



\def\filemod@end{\@gobble{filemod@end}}


%%%%% BASIC FILE DATA COMPARISON

% Expandable form
\def\filemodcmp#1#2{%
    \ifcase0%
        \ifnum\filemodnumdate{#2}>\filemodnumdate{#1}\space1\else
            \ifnum\filemodnumdate{#2}=\filemodnumdate{#1}\space
                \ifnum\filemodnumtime{#2}>\filemodnumtime{#1}\space1\fi
            \fi
        \fi
    \space
       \expandafter\@firstoftwo
    \or
       \expandafter\@secondoftwo
    \fi
}


% Expandable form
\def\filemodCmp#1{%
    \ifx[#1%
      \expandafter\filemod@Cmp@opt
    \else
      \expandafter\filemod@Cmp
      \expandafter\filemodCmpdefault
    \fi
    {#1}%
}

\def\filemodCmpdefault{1}

\def\filemod@Cmp@opt#1#2]{%
    \filemod@Cmp{#2}%
}

\def\filemod@Cmp#1#2#3{%
    \ifcase0%
        \ifnum\filemodnumdate{#3}>\filemodnumdate{#2}\space1\else
            \ifnum\filemodnumdate{#3}=\filemodnumdate{#2}\space
                \ifnum\filemodnumtime{#3}>\filemodnumtime{#2}\space1\else
                    \ifnum\filemodnumdate{#3}=\filemodnumdate{#2}\space2\fi
                \fi
            \fi
        \fi
    \space
       \csname\ifnum#1>2 @firstofthree\else @firstoftwo\fi\expandafter\endcsname
    \or
       \csname\ifnum#1>2 @secondofthree\else @secondoftwo\fi\expandafter\endcsname
    \else
       \csname
       \ifcase#1
         @gobbletwo%
       \or
         @firstoftwo%
       \or
         @secondoftwo%
       \else
         @thirdofthree%
       \fi
       \expandafter
       \endcsname
    \fi
}

\def\@firstofthree#1#2#3{#1}
\def\@secondofthree#1#2#3{#2}


\def\Filemodnewest#1#2{\FilemodOldest{{#1}{#2}}}
\def\Filemodoldest#1#2{\FilemodNewest{{#1}{#2}}}

\newcommand*\FilemodOldest[2][1]{%
    \def\filemode@tie{#1}%
    \def\filemod@gl{<}%
    \Filemod@Newest#2\filemod@end
}

\newcommand*\FilemodNewest[2][1]{%
    \def\filemode@tie{#1}%
    \def\filemod@gl{>}%
    \Filemod@Newest#2\filemod@end
}

\def\Filemod@Newest#1{%
    \def\filemodcmpfile{#1}%
    \filemodgetnum{#1}%
    \let\filemodcmpdate\filemoddate
    \let\filemodcmptime\filemodtime
    \Filemod@@Newest
}
\def\Filemod@@Newest#1{%
  \iffilemod@end{#1}{}{%
    \filemodgetnum{#1}%
    \ifcase0%
        \ifnum\filemoddate\filemod@gl\filemodcmpdate\space1\else
            \ifnum\filemoddate=\filemodcmpdate\space
                \ifnum\filemodtime\filemod@gl\filemodcmptime\space1\else
                    \ifnum\filemoddate=\filemodcmpdate\space
                        \ifnum\filemode@tie=1\else 1\fi
                    \fi
                \fi
            \fi
        \fi
    \else
        \def\filemodcmpfile{#1}%
        \let\filemodcmpdate\filemoddate
        \let\filemodcmptime\filemodtime
    \fi
    \Filemod@@Newest
  }%
}

\def\filemod@gl{>}

\newcommand\Filemodcmp[1][1]{%
    \def\filemod@next{\filemodcmpresult}%
    \Filemod@cmp{#1}%
}

\newcommand\FilemodCmp[1][1]{%
    \let\filemod@next\empty
    \Filemod@cmp{#1}%
}



\def\Filemod@cmp#1#2#3{%
    \filemodgetnum{#2}%
    \let\filemoddatea\filemoddate
    \let\filemodtimea\filemodtime
    \filemodgetnum{#3}%
    \ifcase0%
        \ifnum\filemoddate>\filemoddatea\space1\else
            \ifnum\filemoddate=\filemoddatea\space
                \ifnum\filemodtime>\filemodtimea\space1\else
                    \ifnum\filemoddate=\filemoddatea\space2\fi
                \fi
            \fi
        \fi
    \relax
       \def\filemodcmpfile{#1}%
       \ifnum#1>2\relax
          \def\filemodcmpresult##1##2##3{##1}%
       \else
          \let\filemodcmpresult\@firstoftwo
       \fi
    \or
       \def\filemodcmpfile{#2}%
       \ifnum#1>2\relax
          \def\filemodcmpresult##1##2##3{##2}%
       \else
          \let\filemodcmpresult\@secondoftwo
       \fi
    \else
       \ifcase#1\relax
         \let\filemodcmpfile\empty
         \let\filemodcmpresult\@gobbletwo
       \or
         \def\filemodcmpfile{#1}%
         \let\filemodcmpresult\@firstoftwo
       \or
         \def\filemodcmpfile{#2}%
         \let\filemodcmpresult\@secondoftwo
       \else
         \let\filemodcmpfile\empty
         \let\filemodcmpresult\@thirdofthree
       \fi
    \fi
    \filemod@next
}


